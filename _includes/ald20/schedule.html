<div id="schedule" onload="askForKey()">
    <table class = "table table-bordered">
      	{%- for date in site.data[page.schedule] -%}
	        <th scope="col-lg-2" colspan=100> {{ date.date }} </td> <!-- Really high colspan to span over all columns -->

	        {%- for time in date.timeslots -%}
		        <tr>
		          	<td class="time" scope="row"> {{ time.time }} </td>

		          	{%- for event in time.events -%}

		            	<td colspan="{% if event.colspan %}{{ event.colspan }}{% else %} 1 {% endif%}">
		            		{%- if event.img -%}
		            			<img src="{{ '/assets/img/events/ald20/schedule/' | append: event.img | relative_url }}">
		            		{%- endif -%}


			            	<span class="eventName"> {{ event.name }} </span>

			            	{%- if event.description %}
			            		<br> {{ event.description }}
			            	{%- endif -%}

							{%- if event.linkToTheirPage -%}
								<br>
								<a href="{{ event.linkToTheirPage }} " target="_blank">more information</a>
							{%- endif -%}

			                {%- if event.moreInformation and event.id -%}
				                <br>
				                <a href="javascript:document.getElementById('{{ event.id }}').style.display = 'block'; true;">
				                	more information
				                </a>

							    <div id="{{ event.id }}" class="popup">
								    <div class="popup-content card shadow-sm">
								    	<span class="closePopup" onclick="document.getElementById('{{ event.id }}').style.display='none';">&times;</span>
								    	<p>{{ event.moreInformation }}</p>
								    </div>

								    <!-- Close popup when clicking somewhere else -->
								    <script type="text/javascript">
								    	window.onclick = function(e) {
								    	  var popup = document.getElementById('{{ event.id }}');
										  if (event.target == popup) {
										    popup.style.display = "none";
										  }
										}
									</script>
								</div>
							{%- endif -%}

							<!-- SPECIAL DESCRIPTION AREA FOR PANELISTS -->
							{%- if event.panel -%}
								{%- for each in event.speaker-info-%}
								<hr>
									<p>{{ each.info }} <br> <br></p>
								{%- endfor -%}
							{%- endif -%}
			                
			                {%- if event.link -%} 
			                  <br>
			                  <a class="eventLink" href='{{ event.link }}' target='_blank'>{% if event.platform %}Link to {{ event.platform }}{% else %}Event link{% endif %}</a>
			                {%- endif -%}
	              		</td>	       

		          	{%- endfor -%}
		        </tr>
	        {%- endfor -%}
      	{%- endfor -%}
    </table>
</div>

<script type="text/javascript">
	function askForKey() {
		if (! sessionStorage.getItem('allowLinksToBeShown')) {
			sessionStorage.setItem('allowLinksToBeShown', false);
		}
		var alreadyMadeVisible = sessionStorage.getItem('allowLinksToBeShown');

		var today = new Date();

		if (alreadyMadeVisible == "true") {
			changeVisibilityOfEventLinks("visible");
			console.log("Test1");
			console.log(alreadyMadeVisible);
		} else if (window.location.search == "?pwd=EdinburghAdaLovelace2020") {
			changeVisibilityOfEventLinks("visible");
			console.log("Test2");
		} else if (today.monthIndex == 9) { // only ask for password during october
			var input = prompt("To be able to see the links to attend the events, please enter the key you were given on registration. If you haven't registered yet, just enter nothing.", );
			if (input != "EdinburghAdaLovelace2020") {
				changeVisibilityOfEventLinks("hidden");
			} else {
				changeVisibilityOfEventLinks("visible");
			}			
		} else {
			changeVisibilityOfEventLinks("hidden");
			console.log("Test3");
		}
	}

	function changeVisibilityOfEventLinks(v) {
		if (v == "visible") {
			[].forEach.call(document.querySelectorAll('.eventLink'), function (el) {
					el.style.display = "block";
			});
			sessionStorage.setItem('allowLinksToBeShown', true);
		} else {
			[].forEach.call(document.querySelectorAll('.eventLink'), function (el) {
					el.style.display = "none";
			});
			sessionStorage.setItem('allowLinksToBeShown', false);
		}
	}

	window.onload = askForKey;
</script>
